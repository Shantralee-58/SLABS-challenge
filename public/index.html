<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SouthernLabs Challenge üèÜ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container">
    <h1>SouthernLabs Challenge üèÜ</h1>
    <p class="instructions">
      You have 1 hour to complete 40 logic-based questions.<br>
      Pass mark is 60%. You may skip questions.
    </p>

    <div class="student-box">
      <input type="text" id="name" placeholder="Your Name" required>
      <input type="email" id="email" placeholder="Your Email" required>

      <div class="id-age-row">
        <input type="text" id="idNumber" placeholder="ID / Passport No" maxlength="13" required>

        <select id="age" required>
          <option value="">Age</option>
          <!-- Age dropdown -->
          <option value="18">18</option>
          <option value="19">19</option>
          <option value="20">20</option>
          <option value="21">21</option>
          <option value="22">22</option>
          <option value="23">23</option>
          <option value="24">24</option>
          <option value="25">25</option>
          <option value="26">26</option>
          <option value="27">27</option>
          <option value="28">28</option>
          <option value="29">29</option>
          <option value="30">30</option>
          <option value="31">31</option>
          <option value="32">32</option>
          <option value="33">33</option>
          <option value="34">34</option>
          <option value="35">35</option>
          <option value="36">36</option>
          <option value="37">37</option>
          <option value="38">38</option>
          <option value="39">39</option>
          <option value="40">40</option>
          <option value="41">41</option>
          <option value="42">42</option>
          <option value="43">43</option>
          <option value="44">44</option>
          <option value="45">45</option>
          <option value="46">46</option>
          <option value="47">47</option>
          <option value="48">48</option>
          <option value="49">49</option>
          <option value="50">50</option>
          <option value="51">51</option>
          <option value="52">52</option>
          <option value="53">53</option>
          <option value="54">54</option>
          <option value="55">55</option>
          <option value="56">56</option>
          <option value="57">57</option>
          <option value="58">58</option>
          <option value="59">59</option>
          <option value="60">60</option>
          <option value="61">61</option>
          <option value="62">62</option>
          <option value="63">63</option>
          <option value="64">64</option>
          <option value="65">65</option>
        </select>
      </div>

      <input type="tel" id="contact" placeholder="Contact Number" required>
      <input type="text" id="address" placeholder="Home Address" required>

      <select id="course" required>
        <option value="">Select Course</option>
        <option value="applied_software_development">Applied Software Development</option>
        <option value="software_engineering">Software Engineering</option>
        <option value="it_concepts">IT Concepts</option>
      </select>

      <button id="startBtn">Start Test</button>
    </div>
  </div>

  <!-- ===================== SCRIPT ===================== -->
  <script>
    document.getElementById("startBtn").addEventListener("click", () => {

      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const course = document.getElementById("course").value;
      const idNumber = document.getElementById("idNumber").value.trim();
      const age = parseInt(document.getElementById("age").value);
      const contact = document.getElementById("contact").value.trim();
      const address = document.getElementById("address").value.trim();

      if (!name || !email || !course || !idNumber || !age || !contact || !address) {
        alert("Please fill in all fields.");
        return;
      }

      // Validate South African ID
      if (!isValidSAID(idNumber)) {
        alert("Invalid South African ID number. Please enter a valid ID.");
        return;
      }

      // Validate age vs ID
      const realAge = getAgeFromID(idNumber);
      if (realAge !== age) {
        alert(`Age does not match ID number. Your real age is ${realAge}.`);
        return;
      }

      // Save session data
      sessionStorage.setItem("studentName", name);
      sessionStorage.setItem("studentEmail", email);
      sessionStorage.setItem("studentCourse", course);
      sessionStorage.setItem("studentID", idNumber);
      sessionStorage.setItem("studentContact", contact);
      sessionStorage.setItem("studentAddress", address);
      sessionStorage.setItem("studentAge", age);
      sessionStorage.setItem("currentQuestion", "0");
      sessionStorage.setItem("score", "0");
      sessionStorage.setItem("startTime", new Date().toISOString());

      // Start test
      window.location.href = "test.html";
    });

    function isValidSAID(id) {
      if (!/^\d{13}$/.test(id)) return false;

      const year = parseInt(id.substring(0,2));
      const month = parseInt(id.substring(2,4));
      const day = parseInt(id.substring(4,6));

      const currentYear = new Date().getFullYear() % 100;
      const fullYear = year <= currentYear ? 2000 + year : 1900 + year;

      const dob = new Date(fullYear, month - 1, day);
      if (
        dob.getFullYear() !== fullYear ||
        dob.getMonth() + 1 !== month ||
        dob.getDate() !== day
      ) return false;

      // Luhn checksum
      let sum = 0;
      let alternate = false;

      for (let i = id.length - 1; i >= 0; i--) {
        let n = parseInt(id.charAt(i));
        if (alternate) {
          n *= 2;
          if (n > 9) n -= 9;
        }
        sum += n;
        alternate = !alternate;
      }

      return sum % 10 === 0;
    }

    function getAgeFromID(id) {
      const year = parseInt(id.substring(0,2));
      const month = parseInt(id.substring(2,4));
      const day = parseInt(id.substring(4,6));

      const currentYear = new Date().getFullYear() % 100;
      const fullYear = year <= currentYear ? 2000 + year : 1900 + year;

      const dob = new Date(fullYear, month - 1, day);
      const today = new Date();

      let age = today.getFullYear() - dob.getFullYear();
      const m = today.getMonth() - dob.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
        age--;
      }

      return age;
    }
  </script>

</body>
</html>

